CREATE DATABASE IF NOT EXISTS `lesson_02`;

USE `lesson_02`;

CREATE TABLE IF NOT EXISTS `_countries` (
`id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
`title` VARCHAR(150) NOT NULL);

CREATE INDEX `title` ON `_countries`(`title`);

SHOW COLUMNS FROM `_countries`;

CREATE TABLE IF NOT EXISTS `_regions` (
`id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
`country_id` INT NOT NULL,
`title` VARCHAR(150) NOT NULL);



CREATE INDEX `title` ON `_regions`(`title`);

ALTER TABLE `_regions` 
ADD CONSTRAINT `fk_countries_id` FOREIGN KEY (`country_id`)
REFERENCES `_countries`(`id`)
ON UPDATE CASCADE
ON DELETE RESTRICT;

SHOW COLUMNS FROM `_regions`;

CREATE TABLE IF NOT EXISTS `_cities` (
`id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
`country_id` INT NOT NULL,
`important` TINYINT(1) NOT NULL,
`region_id` INT NOT NULL,
`title` VARCHAR(150) NOT NULL);

CREATE INDEX `title` ON `_cities`(`title`);

ALTER TABLE `_cities`
ADD CONSTRAINT `fk_cities_countries_id` FOREIGN KEY (`country_id`)
REFERENCES `_countries`(`id`)
ON UPDATE CASCADE ON DELETE RESTRICT;

ALTER TABLE `_cities`
ADD CONSTRAINT `fk_cities_regions_id` FOREIGN KEY (`region_id`)
REFERENCES `_regions`(`id`)
ON UPDATE CASCADE ON DELETE RESTRICT;

#другой способ создания таблицы сразу с внешними ключами и индексами

DROP TABLE `_cities`;

CREATE TABLE IF NOT EXISTS `_cities` (
	`id` INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	`country_id` INT NOT NULL,
	`important` TINYINT(1) NOT NULL,
	`region_id` INT NOT NULL,
	`title` VARCHAR(150) NOT NULL,
	INDEX `title` (`title`),
	FOREIGN KEY `fk_cities_countries_id` (`country_id`)
		REFERENCES `_countries`(`id`)
		ON UPDATE CASCADE ON DELETE RESTRICT,
	FOREIGN KEY `fk_cities_regions_id` (`region_id`)
		REFERENCES `_regions`(`id`)
		ON UPDATE CASCADE ON DELETE RESTRICT
	);

SHOW COLUMNS FROM `_cities`;
